import React, { useState } from 'react';
import { ShieldCheck, ChevronDown, RotateCcw } from '../components/icons';
import { TasbihSection } from '../components/TasbihSection';
import { DhikrCounter } from '../components/DhikrCounter';

interface AdhkarItem {
  text: string;
  count: string;
  virtue: string;
}

interface AdhkarCategory {
  id: string; // Added ID for storage keys
  title: string;
  items: AdhkarItem[];
}

const adhkarData: AdhkarCategory[] = [
  {
    id: 'morning',
    title: 'ุฃุฐูุงุฑ ุงูุตุจุงุญ',
    items: [
      { text: 'ุฃูุตูุจูุญูููุง ููุฃูุตูุจูุญู ุงูููููููู ูููููููุ ููุงููุญูููุฏู ูููููููุ ูุงู ุฅููููู ุฅููุงูู ุงูููููู ููุญูุฏููู ูุงู ุดูุฑูููู ููููุ ูููู ุงูููููููู ูููููู ุงููุญูููุฏู ูููููู ุนูููู ููููู ุดูููุกู ููุฏููุฑู. ุฑูุจูู ุฃูุณูุฃููููู ุฎูููุฑู ููุง ููู ููุฐูุง ุงูููููููู ููุฎูููุฑู ููุง ุจูุนูุฏูููุ ููุฃูุนููุฐู ุจููู ูููู ุดูุฑูู ููุง ููู ููุฐูุง ุงูููููููู ููุดูุฑูู ููุง ุจูุนูุฏูููุ ุฑูุจูู ุฃูุนููุฐู ุจููู ูููู ุงููููุณููู ููุณููุกู ุงููููุจูุฑูุ ุฑูุจูู ุฃูุนููุฐู ุจููู ูููู ุนูุฐูุงุจู ููู ุงููููุงุฑู ููุนูุฐูุงุจู ููู ุงููููุจูุฑู.', count: 'ูุฑุฉ ูุงุญุฏุฉ', virtue: 'ุญุตู ูููุณูู ูู ูููู.' },
      { text: 'ุงููููููููู ุจููู ุฃูุตูุจูุญูููุงุ ููุจููู ุฃูููุณูููููุงุ ููุจููู ููุญูููุงุ ููุจููู ูููููุชูุ ููุฅููููููู ุงููููุดููุฑู.', count: 'ูุฑุฉ ูุงุญุฏุฉ', virtue: 'ุงุณุชูุชุงุญ ุงูููู ุจุฐูุฑ ุงููู.' },
      { text: 'ุณูุจูุญูุงูู ุงูููููู ููุจูุญูููุฏููู: ุนูุฏูุฏู ุฎูููููููุ ููุฑูุถูุง ููููุณูููุ ููุฒูููุฉู ุนูุฑูุดูููุ ููููุฏูุงุฏู ููููููุงุชููู.', count: 'ุซูุงุซ ูุฑุงุช', virtue: 'ุฃุฌุฑ ูุถุงุนู ูุซูุงุจ ุนุธูู.' },
      { text: 'ุณูุจูุญูุงูู ุงูููู ููุจูุญูููุฏููู.', count: 'ูุฆุฉ ูุฑุฉ', virtue: 'ุญูุทููุชู ุฎูุทูุงููุงูู ููุฅููู ููุงููุชู ููุซููู ุฒูุจูุฏู ุงููุจูุญูุฑู.'},
      { text: 'ุจูุณููู ุงูููููู ุงูููุฐูู ูุงู ููุถูุฑูู ููุนู ุงุณููููู ุดูููุกู ููู ุงูุฃูุฑูุถู ูููุงู ููู ุงูุณููููุงุกู ูููููู ุงูุณูููููุนู ุงููุนูููููู.', count: 'ุซูุงุซ ูุฑุงุช', virtue: 'ูู ูุถุฑู ูู ุงููู ุดูุก.' },
      { text: 'ุงููููููููู ุนูุงููููู ููู ุจูุฏููููุ ุงููููููููู ุนูุงููููู ููู ุณูููุนููุ ุงููููููููู ุนูุงููููู ููู ุจูุตูุฑููุ ูุงู ุฅููููู ุฅููุงูู ุฃูููุชู.', count: 'ุซูุงุซ ูุฑุงุช', virtue: 'ุณุคุงู ุงููู ุงูุนุงููุฉ ูู ุงูุฌุณุฏ.'}
    ]
  },
  {
    id: 'evening',
    title: 'ุฃุฐูุงุฑ ุงููุณุงุก',
    items: [
      { text: 'ุฃูููุณูููููุง ููุฃูููุณูู ุงูููููููู ูููููููุ ููุงููุญูููุฏู ูููููููุ ูุงู ุฅููููู ุฅููุงูู ุงูููููู ููุญูุฏููู ูุงู ุดูุฑูููู ููููุ ูููู ุงูููููููู ูููููู ุงููุญูููุฏู ูููููู ุนูููู ููููู ุดูููุกู ููุฏููุฑู. ุฑูุจูู ุฃูุณูุฃููููู ุฎูููุฑู ููุง ููู ููุฐููู ุงููููููููุฉู ููุฎูููุฑู ููุง ุจูุนูุฏูููุงุ ููุฃูุนููุฐู ุจููู ูููู ุดูุฑูู ููุง ููู ููุฐููู ุงููููููููุฉู ููุดูุฑูู ููุง ุจูุนูุฏูููุงุ ุฑูุจูู ุฃูุนููุฐู ุจููู ูููู ุงููููุณููู ููุณููุกู ุงููููุจูุฑูุ ุฑูุจูู ุฃูุนููุฐู ุจููู ูููู ุนูุฐูุงุจู ููู ุงููููุงุฑู ููุนูุฐูุงุจู ููู ุงููููุจูุฑู.', count: 'ูุฑุฉ ูุงุญุฏุฉ', virtue: 'ุญุตู ูููุณูู ูู ูููุชู.' },
      { text: 'ุงููููููููู ุจููู ุฃูููุณูููููุงุ ููุจููู ุฃูุตูุจูุญูููุงุ ููุจููู ููุญูููุงุ ููุจููู ูููููุชูุ ููุฅููููููู ุงููููุตููุฑู.', count: 'ูุฑุฉ ูุงุญุฏุฉ', virtue: 'ุฎุชุงู ุงูููู ุจุฐูุฑ ุงููู.' },
      { text: 'ุฃูุนููุฐู ุจูููููููุงุชู ุงูููููู ุงูุชููุงูููุงุชู ูููู ุดูุฑูู ููุง ุฎููููู.', count: 'ุซูุงุซ ูุฑุงุช', virtue: 'ูู ูุถุฑู ุดูุก ูู ุชูู ุงููููุฉ.' }
    ]
  },
   {
    id: 'after_prayer',
    title: 'ุฃุฐูุงุฑ ุจุนุฏ ุงูุตูุงุฉ',
    items: [
      { text: 'ุฃูุณูุชูุบูููุฑู ุงูููููู', count: 'ุซูุงุซ ูุฑุงุช', virtue: 'ููุงู ุซูุงุซุงู ุจุนุฏ ุงูุชุณููู ูู ุงูุตูุงุฉ.' },
      { text: 'ุงููููููููู ุฃูููุชู ุงูุณูููุงูููุ ูููููููู ุงูุณูููุงูููุ ุชูุจูุงุฑูููุชู ููุง ุฐูุง ุงููุฌููุงููู ููุงููุฅูููุฑูุงูู.', count: 'ูุฑุฉ ูุงุญุฏุฉ', virtue: 'ุฏุนุงุก ุจุนุฏ ุงูุชุณููู ูุจุงุดุฑุฉ.' },
      { text: 'ุณูุจูุญูุงูู ุงูููููู', count: 'ุซูุงุซ ูุซูุงุซูู ูุฑุฉ', virtue: 'ุฌุฒุก ูู ุชุณุจูุญุงุช ุฏุจุฑ ุงูุตูุงุฉ ุงูุชู ุชุบูุฑ ุงูุฎุทุงูุง.' },
      { text: 'ุงููุญูููุฏู ููููููู', count: 'ุซูุงุซ ูุซูุงุซูู ูุฑุฉ', virtue: 'ุฌุฒุก ูู ุชุณุจูุญุงุช ุฏุจุฑ ุงูุตูุงุฉ ุงูุชู ุชุบูุฑ ุงูุฎุทุงูุง.' },
      { text: 'ุงูููููู ุฃูููุจูุฑู', count: 'ุซูุงุซ ูุซูุงุซูู ูุฑุฉ', virtue: 'ุฌุฒุก ูู ุชุณุจูุญุงุช ุฏุจุฑ ุงูุตูุงุฉ ุงูุชู ุชุบูุฑ ุงูุฎุทุงูุง.' },
      { text: 'ูุงู ุฅููููู ุฅููุงูู ุงูููููู ููุญูุฏููู ูุงู ุดูุฑูููู ููููุ ูููู ุงูููููููู ูููููู ุงููุญูููุฏู ูููููู ุนูููู ููููู ุดูููุกู ููุฏููุฑู.', count: 'ูุฑุฉ ูุงุญุฏุฉ', virtue: 'ุชูุงู ุงููุฆุฉ ุจุนุฏ ุงูุชุณุจูุญุงุช ูุบูุฑุงู ุงูุฎุทุงูุง.' },
      { text: 'ูุฑุงุกุฉ ุขูุฉ ุงููุฑุณู', count: 'ูุฑุฉ ูุงุญุฏุฉ', virtue: 'ูู ูุฑุฃูุง ุฏุจุฑ ูู ุตูุงุฉ ูู ูููุนู ูู ุฏุฎูู ุงูุฌูุฉ ุฅูุง ุฃู ูููุช.' },
    ]
  },
  {
    id: 'sleep',
    title: 'ุฃุฐูุงุฑ ุงูููู',
    items: [
      { text: 'ูุฌูุน ูููู ุซู ูููุซ ููููุง ูููุฑุฃ: ุณูุฑุฉ ุงูุฅุฎูุงุตุ ูุณูุฑุฉ ุงููููุ ูุณูุฑุฉ ุงููุงุณ.', count: 'ุซูุงุซ ูุฑุงุช', virtue: 'ููุณุญ ุจููุง ูุง ุงุณุชุทุงุน ูู ุฌุณุฏู.' },
      { text: 'ูุฑุงุกุฉ ุขูุฉ ุงููุฑุณู', count: 'ูุฑุฉ ูุงุญุฏุฉ', virtue: 'ูุง ูุฒุงู ุนููู ูู ุงููู ุญุงูุธ ููุง ููุฑุจู ุดูุทุงู ุญุชู ุชุตุจุญ.' },
      { text: 'ุจูุงุณููููู ุฑูุจูููู ููุถูุนููุชู ุฌููููุจููุ ููุจููู ุฃูุฑูููุนููููุ ููุฅููู ุฃูููุณููููุชู ููููุณููู ููุงุฑูุญููููููุงุ ููุฅููู ุฃูุฑูุณูููุชููููุง ููุงุญูููุธููููุง ุจูููุง ุชูุญููููุธู ุจููู ุนูุจููุงุฏููู ุงูุตูููุงููุญููููู.', count: 'ูุฑุฉ ูุงุญุฏุฉ', virtue: 'ุฏุนุงุก ุนูุฏ ุงูููู.' },
      { text: 'ุงููููููููู ููููู ุนูุฐุงุจูููู ููููููู ุชูุจููุนูุซู ุนูุจูุงุฏูู.', count: 'ุซูุงุซ ูุฑุงุช', virtue: 'ุฏุนุงุก ุนูุฏ ุงูููู.' },
    ]
  },
  {
    id: 'misc',
    title: 'ุฃุฏุนูุฉ ูุชููุนุฉ',
    items: [
        { text: 'ุงููููููููู ูุงู ุณููููู ุฅููุงูู ููุง ุฌูุนูููุชููู ุณููููุงูุ ููุฃูููุชู ุชูุฌูุนููู ุงููุญูุฒููู ุฅูุฐูุง ุดูุฆูุชู ุณููููุงู.', count: 'ุนูุฏ ุตุนูุจุฉ ุงูุฃููุฑ', virtue: 'ุฏุนุงุก ูุชุณููู ุงูุฃููุฑ ุงูุตุนุจุฉ.' },
        { text: 'ุฑูุจูู ุงุดูุฑูุญู ููู ุตูุฏูุฑูู ููููุณููุฑู ููู ุฃูููุฑูู ููุงุญููููู ุนูููุฏูุฉู ูููู ูููุณูุงููู ูููููููููุง ููููููู', count: 'ุนูุฏ ุงูุญุงุฌุฉ', virtue: 'ุฏุนุงุก ูุฑุขูู ูุทูุจ ุงูุดุฑุงุญ ุงูุตุฏุฑ ูุชูุณูุฑ ุงูุฃูุฑ.' },
        { text: 'ุงููููููููู ุงููููููู ุจูุญูููุงูููู ุนููู ุญูุฑูุงููููุ ููุฃูุบูููููู ุจูููุถููููู ุนูููููู ุณูููุงูู.', count: 'ููุซุฑ ูููุง', virtue: 'ุฏุนุงุก ููุถุงุก ุงูุฏูู ูุทูุจ ุงูุบูู ูู ุงููู.' },
        { text: 'ุงููููููููู ุฅููููู ุฃูุณูุฃููููู ุนูููููุง ููุงููุนูุงุ ููุฑูุฒูููุง ุทููููุจูุงุ ููุนูููููุง ููุชูููุจููููุง.', count: 'ุจุนุฏ ุตูุงุฉ ุงููุฌุฑ', virtue: 'ุฏุนุงุก ูุจูู ูุทูุจ ุงูุฑุฒู ุงูุทูุจ ูุงูุนูู ุงููุงูุน.' },
        { text: 'ููุง ุฅููููู ุฅููููุง ุงูููู ุงููุนูุธูููู ุงููุญููููููุ ููุง ุฅููููู ุฅููููุง ุงูููู ุฑูุจูู ุงููุนูุฑูุดู ุงููุนูุธููููุ ููุง ุฅููููู ุฅููููุง ุงูููู ุฑูุจูู ุงูุณููููููุงุชู ููุฑูุจูู ุงููุฃูุฑูุถู ููุฑูุจูู ุงููุนูุฑูุดู ุงููููุฑูููู.', count: 'ุนูุฏ ุงููุฑุจ', virtue: 'ุฏุนุงุก ุงููุฑุจ ูุฅุฒุงูุฉ ุงููู ูุงูุบู.' },
        { text: 'ุฃูุฐูููุจู ุงููุจูุงุณู ุฑูุจูู ุงููููุงุณูุ ููุงุดููู ุฃูููุชู ุงูุดููุงูููุ ูุงู ุดูููุงุกู ุฅููุงูู ุดูููุงุคูููุ ุดูููุงุกู ูุงู ููุบูุงุฏูุฑู ุณูููููุง.', count: 'ุนูุฏ ุงููุฑุถ', virtue: 'ุฏุนุงุก ูุจูู ูุทูุจ ุงูุดูุงุก ูููุฑูุถ.' },
    ]
  },
   {
    id: 'istikhara',
    title: 'ุฏุนุงุก ุงูุงุณุชุฎุงุฑุฉ',
    items: [
        { text: 'ุงููููููููู ุฅููููู ุฃูุณูุชูุฎููุฑููู ุจูุนูููููููุ ููุฃูุณูุชูููุฏูุฑููู ุจูููุฏูุฑูุชูููุ ููุฃูุณูุฃููููู ูููู ููุถููููู ุงููุนูุธููููุ ููุฅูููููู ุชูููุฏูุฑู ูููุงู ุฃูููุฏูุฑูุ ููุชูุนููููู ูููุงู ุฃูุนูููููุ ููุฃูููุชู ุนููุงูููู ุงููุบููููุจู. ุงููููููููู ุฅููู ููููุชู ุชูุนููููู ุฃูููู ููุฐูุง ุงูุฃูููุฑู -ููููุณููููู ุญูุงุฌูุชููู- ุฎูููุฑู ููู ููู ุฏููููู ููููุนูุงุดูู ููุนูุงููุจูุฉู ุฃูููุฑูู ููุงููุฏูุฑููู ููู ููููุณููุฑููู ููู ุซูููู ุจูุงุฑููู ููู ูููููุ ููุฅููู ููููุชู ุชูุนููููู ุฃูููู ููุฐูุง ุงูุฃูููุฑู ุดูุฑูู ููู ููู ุฏููููู ููููุนูุงุดูู ููุนูุงููุจูุฉู ุฃูููุฑูู ููุงุตูุฑููููู ุนููููู ููุงุตูุฑูููููู ุนูููููุ ููุงููุฏูุฑู ููู ุงููุฎูููุฑู ุญูููุซู ููุงูู ุซูููู ุฃูุฑูุถูููู ุจููู.', count: 'ูุฑุฉ ูุงุญุฏุฉ ุนูุฏ ุงูุญุงุฌุฉ', virtue: 'ูุทูุจ ุงูุฎูุฑุฉ ูู ุงููู ูู ุงูุฃููุฑ ูููุง.' },
    ]
  }
];


const AccordionItem: React.FC<{ title: string; children: React.ReactNode; isOpen: boolean; onClick: () => void; }> = ({ title, children, isOpen, onClick }) => {
  return (
    <div className="border-b border-slate-200 dark:border-slate-700 last:border-b-0">
      <button
        onClick={onClick}
        className={`w-full flex justify-between items-center text-right p-5 focus:outline-none transition-colors ${isOpen ? 'bg-slate-100 dark:bg-slate-700/30' : 'hover:bg-slate-50 dark:hover:bg-slate-700/50'}`}
        aria-expanded={isOpen}
      >
        <h2 className={`text-xl font-bold transition-colors font-serif ${isOpen ? 'text-amber-600 dark:text-amber-400' : 'text-slate-800 dark:text-slate-100'}`}>{title}</h2>
        <ChevronDown className={`w-6 h-6 text-slate-400 transition-transform duration-300 ${isOpen ? 'rotate-180' : ''}`} />
      </button>
      <div className={`overflow-hidden transition-all duration-500 ease-in-out ${isOpen ? 'max-h-[3000px] opacity-100' : 'max-h-0 opacity-0'}`}>
        <div className="p-4 bg-slate-50 dark:bg-slate-800/30 space-y-4">
          {children}
        </div>
      </div>
    </div>
  );
};

export const AdhkarView: React.FC = () => {
    const [openIndex, setOpenIndex] = useState<number | null>(0);
    const [resetTrigger, setResetTrigger] = useState(0);

    const handleToggle = (index: number) => {
        setOpenIndex(openIndex === index ? null : index);
    };

    const resetAllAdhkar = () => {
        if (window.confirm('ูู ุฃูุช ูุชุฃูุฏ ูู ุฑุบุจุชู ูู ุจุฏุก ููู ุฌุฏูุฏ ูุชุตููุฑ ุฌููุน ุนุฏุงุฏุงุช ุงูุฃุฐูุงุฑุ (ูู ูุชู ุชุตููุฑ ูุฌููุน ุงูุชุณุจูุญ ุงูููู)')) {
            setResetTrigger(prev => prev + 1);
            if (typeof navigator !== 'undefined' && navigator.vibrate) navigator.vibrate([50, 50]);
        }
    };

  return (
    <div className="h-full flex flex-col p-4 sm:p-6">
        <div className="flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-6 sticky top-0 z-20 bg-slate-50/95 dark:bg-slate-900/95 backdrop-blur-sm py-3 -mx-4 px-4 border-b border-slate-200 dark:border-slate-800 shadow-lg">
            <div className="flex items-center gap-3">
                <ShieldCheck className="w-8 h-8 text-amber-500 dark:text-amber-400" />
                <h1 className="text-3xl font-bold text-amber-600 dark:text-amber-400 font-serif">ุญุตู ุงููุณูู</h1>
            </div>
            <button 
                onClick={resetAllAdhkar}
                className="flex items-center justify-center gap-2 bg-white dark:bg-slate-800 hover:bg-amber-500 hover:text-white dark:hover:text-slate-900 text-slate-600 dark:text-slate-200 px-4 py-2.5 rounded-xl text-sm font-bold transition-all shadow-md border border-slate-200 dark:border-slate-600 hover:border-amber-400"
            >
                <RotateCcw className="w-4 h-4" />
                ุจุฏุก ููู ุฌุฏูุฏ
            </button>
        </div>
       
        <div className="overflow-y-auto flex-grow space-y-8 pb-20">
            <TasbihSection />
            
            <div className="space-y-4">
                <div className="px-2">
                    <h3 className="text-2xl font-bold text-slate-800 dark:text-slate-100 mb-2 font-serif">ุงูุฃุฐูุงุฑ ุงููููุฏุฉ</h3>
                    <p className="text-slate-600 dark:text-slate-400 text-sm leading-relaxed">ุงูุฃุฐูุงุฑ ุงููุฑุชุจุทุฉ ุจููุช ุฃู ุนุฏุฏ ูุนูู. ูุชู ุญูุธ ุชูุฏูู ุชููุงุฆูุงู ูู ุงููุชุตูุญ.</p>
                </div>
                
                <div className="rounded-2xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 overflow-hidden shadow-xl animate-fade-in">
                {adhkarData.map((category, index) => (
                    <AccordionItem
                    key={category.id}
                    title={category.title}
                    isOpen={openIndex === index}
                    onClick={() => handleToggle(index)}
                    >
                        {category.items.map((item, itemIndex) => (
                        <div key={itemIndex} className="relative p-5 bg-slate-50 dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-700/50 hover:border-amber-500/30 transition-all shadow-sm group">
                             {/* Right Accent Line */}
                             <div className="absolute right-0 top-6 bottom-6 w-1 bg-amber-500/30 group-hover:bg-amber-500 transition-colors rounded-l-full"></div>
                             
                            <div className="pr-4">
                                <p className="text-slate-800 dark:text-slate-100 leading-loose text-xl mb-5 font-serif text-justify">{item.text}</p>
                                <div className="flex flex-col sm:flex-row justify-between items-end sm:items-center gap-4 pt-4 border-t border-slate-200 dark:border-slate-800">
                                    <div className="w-full sm:w-auto">
                                        <DhikrCounter 
                                            countString={item.count} 
                                            storageKey={`adhkar-${category.id}-${itemIndex}`}
                                            resetTrigger={resetTrigger}
                                        />
                                    </div>
                                    <div className="flex items-center gap-2 text-slate-500 dark:text-slate-400 bg-white dark:bg-slate-800 px-3 py-1.5 rounded-lg text-xs sm:text-sm border border-slate-200 dark:border-slate-700 w-full sm:w-auto justify-center sm:justify-start">
                                        <span className="text-amber-500 text-base">๐ก</span>
                                        <span className="font-medium">{item.virtue}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        ))}
                    </AccordionItem>
                ))}
                </div>
            </div>
        </div>
    </div>
  );
};